# AI言語学習プラットフォーム - 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**HaiLanGo**

### 1.2 コアコンセプト
既存の言語学習本とAI技術を組み合わせ、個人に最適化された能動的な言語学習環境を提供する。
ゴールは**日常会話レベルの習得**であり、文法よりも会話パターンと単語量を重視する。

### 1.3 主要な価値提案
- 手持ちの言語学習本を最大限に活用
- AI教師による24/7の個別指導
- 著作権を尊重したプライベート学習環境
- 「話すことを迫られる」インタラクティブな体験

---

## 2. 機能要件

### 2.1 書籍のデジタル化（OCR機能）

#### 対応フォーマット
- 画像：PNG, HEIC（PNG変換）, JPG
- PDF（メイン対応）
- 連続アップロード対応

#### OCR精度要件
- 複雑なレイアウト対応（表、ルビ、縦書き）
- 多言語対応（詳細は2.3参照）
- ユーザーによる手動修正機能（任意）

#### 言語設定
- **母国語**：ユーザーのインターフェース言語（例：日本語）
- **学習先言語**：習得したい言語（例：クルド語）
- **参照言語**：本の仲介言語（例：英語←→クルド語の本を日本語話者が使用）

### 2.2 音声機能

#### TTS（Text-to-Speech）
**主要サポート言語（優先度高）**
- 日本語、中国語、英語、ロシア語
- ペルシャ語、ヘブライ語
- スペイン語、フランス語、ポルトガル語
- ドイツ語、イタリア語、トルコ語
- その他の言語も生成AIAPI元がサポートすればサポートただし，正確さは欠くかもしれない．

**機能**
- 速度調整（0.5x〜2.0x）
- 音質レベル：
  - 無料版：標準品質
  - プレミアム版：高品質（Stripe課金）

#### STT（Speech-to-Text）
- **評価粒度**：単語レベル
- **フィードバック**：
  - スコア表示（0-100点）
  - 具体的な改善点提示（英会話教室風）
  - 発音のビジュアル化（波形など）

### 2.3 インタラクティブ学習機能

#### 学習モード
1. **ページバイページモード**
   - 本の1ページずつを一緒に学習
   - フレーズのリピート練習
   - ロールプレイ形式の会話練習

2. **教師モード（自動学習モード）** ⭐ NEW
   - **コンセプト**：ボタン一つで教師が授業をするように連続自動再生
   - **基本動作**：
     - 全ページを自動で順次進行
     - 各ページで音声読み上げ + 解説
     - 設定した間隔で次のページへ自動遷移
   - **バックグラウンド再生**：
     - 画面オフでも再生継続
     - ロック画面からのコントロール
     - 通知センターでの操作
   - **カスタマイズ設定**：
     - 再生速度：0.5x 〜 2.0x
     - ページ間隔：0秒 〜 30秒
     - リピート回数：1〜3回
     - 学習内容：
       - ✓ 学習先言語の読み上げ（必須）
       - ✓ 母国語訳の読み上げ（オプション）
       - ✓ 単語解説（オプション）
       - ✓ 文法解説（オプション）
       - ✓ 発音練習タイム（オプション）
   - **オフライン対応**：
     - 音声データの事前一括ダウンロード
     - Wi-Fi接続時のみダウンロード推奨
     - ダウンロード管理画面
   - **ユースケース**：
     - 通勤・通学中の聞き流し学習
     - 就寝前のリスニング
     - 家事をしながらの学習
     - 運転中の音声学習

#### 学習進捗管理
- 既出フレーズの記録
- 間隔反復学習（Spaced Repetition）アルゴリズム
- 達成度・継続日数の可視化
- 弱点分析（発音が苦手な単語など）

#### 単語・文法サポート
- **単語**：辞書API連携による詳細解説
- **文法**：最低限の説明のみ
- **会話パターン**：繰り返し出現するパターンの自動抽出・提示

### 2.4 ユーザー生成コンテンツ（将来機能）
- 手書きノートなどの自作教材の共有
- ブログ投稿型のプラットフォーム
- コミュニティ機能（レビュー・コメント）

---

## 3. 非機能要件

### 3.1 プライバシー・セキュリティ

#### データ保存方針
- **書籍データ**：ユーザーが削除するまで保存
- **OCR結果**：Redisでキャッシュ、PostgreSQLに永続化
- **暗号化**：E2E暗号化（End-to-End Encryption）
- **著作権対応**：個人利用に限定、外部共有は禁止（ユーザー生成コンテンツを除く）

#### 認証
- OAuth 2.0（Google Login）
- Email/Password認証
- JWT（JSON Web Token）でのセッション管理

### 3.2 パフォーマンス
- **OCR処理時間**：外部API依存（目標：1ページ5-10秒）
- **TTSレイテンシ**：リアルタイム読み上げ（1秒以内の開始）
- **STT処理**：録音終了後3秒以内のフィードバック

### 3.3 スケーラビリティ
- **初期**：個人利用（セルフホスト）
- **将来**：一般公開、マルチテナント対応
- 水平スケーリング可能なアーキテクチャ

---

## 4. 技術スタック

### 4.1 バックエンド
- **言語**：Go（メイン）
  - 並行処理性能
  - 開発速度
  - エコシステムの充実
- **補助**：Python（最終手段、gRPC連携）
  - 機械学習推論など
- **API設計**：RESTful API + WebSocket（リアルタイム機能）

### 4.2 フロントエンド
- **Web**：Next.js（TypeScript, React, TailwindCSS, ShadCN/UI, BiomeJS）
  - SSR/SSG対応
  - ファイルアップロードのみ（カメラなし）
- **Mobile**：Flutter
  - iOS/Android対応
  - カメラ撮影機能
  - 全機能対応

### 4.3 データベース
- **PostgreSQL**
  - ユーザー情報
  - 学習履歴
  - 書籍メタデータ
  - お気に入り・ブックマーク
- **Redis**
  - セッション管理
  - OCR結果の一時キャッシュ
  - レート制限

### 4.4 インフラ
- **初期**：オンプレミス（セルフホスト）
  - Docker Compose / Podman
  - `.env`での環境変数管理
- **将来**：クラウドマイグレーション
  - AWS / GCP / Cloudflare（コスパ重視）
  - Terraform for IaC
  - 候補：
    - Cloudflare Workers/Pages（エッジコンピューティング）
    - AWS Lambda + API Gateway（サーバーレス）
    - GCP Cloud Run（コンテナ）

### 4.5 外部API

#### 現在計画中のAPI
- **OCR**：Google Vision API / Azure Computer Vision / Tesseract（オープンソース）
- **TTS**：Google Cloud TTS / Amazon Polly / ElevenLabs（プレミアム）
- **STT**：Google Cloud STT / Whisper API
- **辞書**：Oxford Dictionary API / Free Dictionary API / Wiktionary API
- **決済**：Stripe

#### 新規検討中のAPI（詳細は api_integration_proposal.md を参照）
- **リアルタイム音声対話**：OpenAI Realtime API / gpt-realtime ⭐ NEW
- **PDF処理**：MarkPDFdown（GitHub）⭐ NEW
- **翻訳**：DeepL API
- **ストレージ**：Cloudflare R2
- **監視**：Sentry
- **AI生成**：Anthropic Claude API

---

## 5. ビジネスモデル

### 5.1 収益化戦略
#### 無料プラン
- 1日1ページまで学習可能
- 1日30分まで使用可能
- 標準品質のTTS

#### プレミアムプラン（月額/年額）
- 無制限の学習
- 高品質TTS
- オフライン音声ダウンロード
- 優先サポート

### 5.2 コスト構造
- **AI API**：運営負担（ユーザーのAPIキーは不要）
- **サーバー**：初期は低コスト、スケールに応じて最適化
- **開発**：個人開発→将来的にチーム化

---

## 6. 開発ロードマップ

### Phase 1: MVP（3-4ヶ月）
- [ ] ユーザー認証（OAuth + Email）
- [ ] PDFアップロード + OCR
- [ ] TTS基本機能（主要言語5つ）
- [ ] 簡易な単語帳機能
- [ ] Web版のみ

### Phase 2: コア機能（2-3ヶ月）
- [ ] STT + 発音評価
- [ ] ページバイページ学習モード
- [ ] 間隔反復学習アルゴリズム
- [ ] モバイルアプリ（Flutter）
- [ ] Stripe決済統合

### Phase 3: 拡張機能（3-4ヶ月）
- [ ] 教師読み上げモード（オフライン対応）
- [ ] 辞書API統合
- [ ] 学習分析ダッシュボード
- [ ] マイナー言語対応拡大

### Phase 4: コミュニティ（時期未定）
- [ ] ユーザー生成コンテンツ機能
- [ ] ブログ投稿プラットフォーム
- [ ] コミュニティフォーラム

---

## 7. リスクと対策

### 7.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| OCR精度不足 | 高 | 複数API併用、ユーザー修正機能 |
| AI APIコスト高騰 | 高 | 使用量制限、キャッシュ戦略、ユーザー課金 |
| マイナー言語のサポート不足 | 中 | 段階的対応、コミュニティ翻訳 |

### 7.2 ビジネスリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| ユーザー獲得難 | 中 | SNSマーケティング、無料期間延長 |
| 競合サービス | 中 | ニッチ（既存書籍活用）の強化 |

### 7.3 法的リスク
- **著作権**：法律専門家確認済み
- **プライバシー**：GDPR/CCPA準拠（将来的に）
- **利用規約**：書籍の私的利用限定を明記

---

## 8. 成功指標（KPI）

### Phase 1（MVP）
- アカウント登録数：100人
- 平均継続日数：7日
- OCR成功率：90%以上

### Phase 2（コア機能）
- 有料会員転換率：5%
- 月間アクティブユーザー：500人
- 平均学習時間：週3時間

### Phase 3以降
- 月間アクティブユーザー：10,000人
- 収益：サーバーコストをカバー
- ユーザー満足度：4.5/5.0以上

---

## 9. 次のアクション

### 即時対応が必要な項目
1. **技術検証**
   - OCR APIの精度比較（Google Vision vs Azure vs Tesseract）
   - TTS/STT APIのコスト試算
   - E2E暗号化の実装方法調査

2. **設計ドキュメント作成**
   - システムアーキテクチャ図
   - データベーススキーマ設計
   - API仕様書

3. **開発環境構築**
   - リポジトリ作成（GitHub/GitLab）
   - Podman + Docker Compose設定
   - CI/CD パイプライン

### 短期（1-2週間）
- プロトタイプの開発開始
- デザインモックアップ作成（Figma）
- 主要な外部APIのアカウント作成・テスト

### 中期（1-2ヶ月）
- MVP機能の実装
- ベータテスター募集
- フィードバック収集・改善

---

## 10. 追加で明確化が必要な項目

### 10.1 UI/UX関連
- **参考にしたいアプリは？**（Duolingo、Anki、Memrise等）
- **ターゲットユーザーのペルソナ**：年齢層、技術リテラシー、学習動機
- **アクセシビリティ要件**：色覚異常対応、フォントサイズ調整など

### 10.2 学習アルゴリズム
- **間隔反復学習の具体的なパラメータ**：何日後に復習？
- **難易度調整**：ユーザーのレベルに応じた出題順序
- **ゲーミフィケーション**：ポイント、バッジ、ストリーク機能の有無

### 10.3 データ管理
- **書籍データの複数デバイス同期**：Webとモバイル間で同期する？
- **バックアップ戦略**：ユーザーデータのエクスポート機能
- **データ削除ポリシー**：アカウント削除時の処理

### 10.4 サポート・コミュニティ
- **カスタマーサポート体制**：チャット、メール、FAQ
- **バグレポート機能**：アプリ内フィードバックフォーム
- **多言語UI対応**：英語・日本語以外のサポート計画

---

## 11. 推奨される次のドキュメント

以下のドキュメントを順次作成していくことをお勧めします：

1. **システムアーキテクチャ設計書**
   - コンポーネント図
   - シーケンス図
   - インフラ構成図

2. **データベース設計書**
   - ER図
   - テーブル定義
   - インデックス戦略

3. **API仕様書**
   - エンドポイント一覧
   - リクエスト/レスポンス形式
   - 認証フロー

4. **UI/UXデザインガイドライン**
   - ワイヤーフレーム
   - カラーパレット
   - コンポーネントライブラリ

5. **セキュリティ設計書**
   - 脅威モデリング
   - 暗号化方式
   - 脆弱性対策

6. **テスト計画書**
   - 単体テスト
   - 統合テスト
   - E2Eテスト

---

## まとめ

このプロジェクトは非常に野心的で、言語学習の民主化に大きく貢献できる可能性があります。
技術的にも実現可能で、段階的な開発によってリスクを最小化できます。

**最も重要な次のステップ**は、**MVP機能の絞り込み**と**技術検証（PoC: Proof of Concept）**です。
